#!/bin/bash

# Output CSV file
OUTPUT_FILE="pokemon_summary.csv"

# Check if JSON files exist
if ! ls *.json 1> /dev/null 2>&1; then
    echo "No JSON files found. Make sure to run the batch retrieval script first."
    exit 1
fi

# Write the CSV header
echo "Name,Height (m),Weight (kg)" > "$OUTPUT_FILE"

# Initialize variables for averaging
TOTAL_HEIGHT=0
TOTAL_WEIGHT=0
COUNT=0

# Process each JSON file
for FILE in *.json; do
    # Extract name, height, and weight
    DATA=$(jq -r '[.name, (.height / 10), (.weight / 10)] | @csv' "$FILE")
    echo "$DATA" >> "$OUTPUT_FILE"

    # Extract numerical values for height and weight using sed
    HEIGHT=$(echo "$DATA" | sed -E 's/[^,]*,([^,]*),.*/\1/')
    WEIGHT=$(echo "$DATA" | sed -E 's/[^,]*,[^,]*,(.*)/\1/')

    # Accumulate totals
    TOTAL_HEIGHT=$(echo "$TOTAL_HEIGHT + $HEIGHT" | bc)
    TOTAL_WEIGHT=$(echo "$TOTAL_WEIGHT + $WEIGHT" | bc)
    COUNT=$((COUNT + 1))
done

# Calculate and display averages
AVG_HEIGHT=$(echo "scale=2; $TOTAL_HEIGHT / $COUNT" | bc)
AVG_WEIGHT=$(echo "scale=2; $TOTAL_WEIGHT / $COUNT" | bc)
echo "Average Height (m): $AVG_HEIGHT"
echo "Average Weight (kg): $AVG_WEIGHT"

# Inform the user
echo "Summary saved to $OUTPUT_FILE."
